'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
var g = window;
g.TSH_Events_pool = g.TSH_Events_pool || {};
var pool = g.TSH_Events_pool;

function Events(cls) {
  var events = [];
  cls.prototype.on = function (eventName, callback) {
    if (eventName && typeof eventName === 'string' && typeof callback === 'function') {
      if (!Array.isArray(pool[eventName])) {
        pool[eventName] = [];
      }
      pool[eventName].push(callback);
      events.push({ eventName: eventName, callback: callback });
    }
  };
  cls.prototype.emit = function (eventName) {
    for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
      args[_key - 1] = arguments[_key];
    }

    var evts = pool[eventName];
    if (Array.isArray(evts)) {
      evts.forEach(function (v) {
        v.apply(undefined, args);
      });
    }
  };
  var componentWillUnmount = cls.prototype.componentWillUnmount;
  cls.prototype.componentWillUnmount = function () {
    if (typeof componentWillUnmount === 'function') {
      componentWillUnmount();
    }
    // ===
    events.forEach(function (item) {
      Remove(item);
    });
    // ===
    events.length = 0;
  };
}

function Remove(item) {
  if (Array.isArray(pool[item.eventName])) {
    pool[item.eventName].forEach(function (v, i) {
      if (v === item.callback) {
        g.TSH_Events_pool.splice(i, 1);
      }
    });
  }
}

exports.default = Events;
module.exports = exports['default'];